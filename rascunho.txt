#arquivo usuario.py

from main import db

class Usuarios(db.Model):
    nickname = db.Column(db.String(15), primary_key=True)
    nome = db.Column(db.String(15), nullable=False)
    senha = db.Column(db.String(15), nullable=False)

    def __repr__(self):
        return '<Nome%r>' % self.nome



#arquivo view.py

from flask import render_template, request, redirect, session, flash, url_for
from main import app, db
from models.pessoa import Pessoa
from models.usuario import Usuarios

@app.route('/registrar', methods=['GET', 'POST'])
def registrar():
    nome_usuario = request.form['username']
    nickname_usuario = request.form['nickname']
    senha_usuario = request.form['password']
    #verificar se  ususario ja existe  no banco de dados
    existe_ususario = Usuarios.query.filter_by(nome=nome_usuario).count()
    if existe_ususario>0 :
        flash("Usuario já cadastrado")
    #criar novo usuario
    else:
        novo_usuario = Usuarios(nome=nome_usuario,nickname=nickname_usuario,senha=senha_usuario)
        db.session.add(novo_usuario)
        db.session.commit()
        flash("Registro de novo usuario realizado com sucesso")

    # Redirecionar de volta para a página principal
    return redirect(url_for('inicio'))

#arquivo template.html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <!-- Adicionando o link do CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex</title>
</head>
<!-- body inicio do corpo do site -->
<body>
    <header>

      <ul class="nav nav-tabs">
        
        <li class="nav-item">
            <a class="nav-link" href="/registrar">Registrar</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/">Lista</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/novo">Cadastro</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Sair</a>
        </li>
        
      </ul>
    </header>

    <div class="container">
        {% with messages = get_flashed_messages() %}
            {% if messages %} 
                <ul id="messages" class="list-unstyled">
                {% for message in messages %}
                    <li class="alert alert-success">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        <div class="page-header">
            <h1>{{ titulo }}</h1>
        </div>

        {% block conteudo %} {% endblock %}
    </div>

    <footer>
        <p>Desenvolvido pela turma de PYTHON segunda e quarta !!</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>


#arquivo registrar.html

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <!-- Adicionando o link do CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex</title>
</head>
<!-- body inicio do corpo do site -->
<body>
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul id="messages" class="list-unstyled">
        {% for message in messages %}
            <li class="alert alert-success">{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
    {% endwith %}

    <div class="container">
        <h1>Faca seu registro</h1>

        <form action="{{ url_for('registrar')}}", method="post">

        <p><label>USERNAME</label>
            <input class="form-control" type="text" name="username" required></p>
              
        <p><label for="nickname">Nickname do usuario</label>
            <input type="text" id="nickname"  name="nickname" required></p>
    
        <p><label>PASSWORD</label>
            <input class="form-control" type="password" name="password" required></p>
            <p><button class="btn btn-primary" type="submit">Entrar</button></p>
        </form>
    </div>
</body>
</html>

#arquivo main.py

import socket
import os
from flask import Flask
from flask_sqlalchemy import SQLAlchemy



app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///' + os.path.join(app.root_path, 'banco/aplication.sqlite3')
app.config['SECRET_KEY'] = '123456'
db = SQLAlchemy(app)


from view import *


def get_server_ip():
    hostname = socket.gethostname()
    server_ip = socket.gethostbyname(hostname)
    return server_ip


#server_ip = get_server_ip()
#print(server_ip)
#app.run(host=f"{server_ip}", port=80, debug=True)

if __name__ == '__main__':
    app.run(debug=True)



